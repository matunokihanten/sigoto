<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>Universal Data Editor & Converter (Pro)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root { 
      --primary: #2563eb; 
      --header-bg: #4472C4; /* Excel Blue */
      --header-text: #ffffff;
      --bg: #f1f5f9; 
      --surface: #ffffff; 
      --border: #cbd5e1; 
      --text: #1e293b; 
    }
    body { font-family: "Meiryo", "Hiragino Kaku Gothic ProN", sans-serif; background: var(--bg); color: var(--text); padding: 24px; margin: 0; }
    
    h1 { font-size: 1.5rem; margin: 0 0 1rem 0; color: #0f172a; display:flex; align-items:center; gap:10px;}
    
    /* ã‚«ãƒ¼ãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
    .card { background: var(--surface); border: 1px solid var(--border); border-radius: 8px; padding: 20px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); margin-bottom: 20px; }
    
    /* ãƒ‰ãƒ­ãƒƒãƒ—ã‚¾ãƒ¼ãƒ³ */
    #dropZone {
      border: 2px dashed #94a3b8; border-radius: 8px; padding: 30px; text-align: center;
      transition: all 0.2s; cursor: pointer; background: #f8fafc;
    }
    #dropZone:hover, #dropZone.dragover { border-color: var(--primary); background: #eff6ff; }
    
    /* ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« */
    .controls { display: flex; gap: 16px; flex-wrap: wrap; align-items: flex-end; }
    .control-group { display: flex; flex-direction: column; gap: 6px; }
    label { font-size: 0.85rem; font-weight: bold; color: #475569; }
    
    button { 
      padding: 10px 20px; border-radius: 6px; font-weight: 600; cursor: pointer; border: none; font-size: 0.95rem; 
      transition: transform 0.1s;
    }
    button:active { transform: scale(0.98); }
    #convertBtn { background: var(--primary); color: white; box-shadow: 0 4px 6px rgba(37,99,235,0.2); }
    #convertBtn:hover { background: #1d4ed8; }
    
    /* ç·¨é›†å¯èƒ½ãªãƒ†ãƒ¼ãƒ–ãƒ« */
    #tableWrapper {
      max-height: 70vh; /* ç”»é¢ã®7å‰²ã¾ã§è¡¨ç¤º */
      overflow: auto;
      border: 1px solid #cbd5e1;
      border-radius: 6px;
      background: white;
      position: relative;
    }
    
    table { width: 100%; border-collapse: collapse; font-size: 13px; table-layout: fixed; }
    
    /* ãƒ˜ãƒƒãƒ€ */
    th { 
      background: var(--header-bg); 
      color: var(--header-text); 
      position: sticky; top: 0; z-index: 10; 
      padding: 10px; border: 1px solid #365da3; 
      white-space: nowrap; font-weight: normal;
      min-width: 80px;
    }
    
    /* ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ« */
    td { 
      border: 1px solid #d1d5db; 
      padding: 8px; 
      min-width: 80px; 
      overflow: hidden; 
      white-space: nowrap;
      outline: none; /* ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚ã®æ ç·šã‚’æ¶ˆã™ */
    }
    
    /* ç·¨é›†å¯èƒ½ã§ã‚ã‚‹ã“ã¨ã‚’ç¤ºã™ */
    td[contenteditable="true"]:hover { background-color: #f1f5f9; cursor: text; }
    td[contenteditable="true"]:focus { background-color: #e0f2fe; border: 2px solid var(--primary); z-index: 2; position:relative; }
    
    /* è¡Œç•ªå· */
    td.row-num { background: #f1f5f9; text-align: center; color: #64748b; font-size: 11px; user-select: none; width: 40px; min-width: 40px; border-color: #cbd5e1; }
    
    /* å¶æ•°è¡Œã®èƒŒæ™¯ï¼ˆã‚¹ãƒˆãƒ©ã‚¤ãƒ—ï¼‰ */
    tr:nth-child(even) td:not(.row-num) { background: #fcfcfc; }

    /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸ */
    .badge { display: inline-block; padding: 4px 10px; border-radius: 99px; font-size: 0.75rem; font-weight: bold; background: #e2e8f0; color: #475569; margin-left: 10px; }
    .badge.info { background: #dbeafe; color: #1e40af; }
    
    /* ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ */
    #loadingOverlay {
      position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(255,255,255,0.9); z-index: 999;
      display: none; flex-direction: column; align-items: center; justify-content: center;
    }
    .spinner { width: 40px; height: 40px; border: 4px solid #e2e8f0; border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }

  </style>

  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jschardet@3.0.0/dist/jschardet.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/encoding-japanese/2.0.0/encoding.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/exceljs/dist/exceljs.min.js"></script>
</head>
<body>

  <h1>ğŸ“Š Excel Editor & Beautiful Converter <span id="fileStatus" class="badge">ãƒ•ã‚¡ã‚¤ãƒ«æœªé¸æŠ</span></h1>

  <div class="card" id="inputArea">
    <div id="dropZone">
      <p style="margin:0; font-size:1.1em; color:#475569;">
        <strong>ã“ã“ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ­ãƒƒãƒ—</strong><br>
        <span style="font-size:0.85em;">(.csv, .xlsx, .txt)</span>
      </p>
      <input type="file" id="fileInput" accept=".csv,.txt,.xlsx,.xls" style="display:none" />
    </div>
  </div>

  <div class="card" id="editorArea" style="display:none;">
    <div class="controls" style="margin-bottom:15px;">
      <div class="control-group">
        <label>ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œ</label>
        <div style="font-size:0.9rem; color:#666;">
          ç¾åœ¨è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹å†…å®¹ã‚’ãã®ã¾ã¾ExcelåŒ–ã—ã¾ã™ã€‚<br>
          <small>â€»ã‚»ãƒ«ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ç›´æ¥ç·¨é›†ã§ãã¾ã™ã€‚</small>
        </div>
      </div>
      <div style="flex-grow:1"></div>
      <div class="control-group">
        <label>ã‚ªãƒ—ã‚·ãƒ§ãƒ³</label>
        <label style="font-weight:normal; font-size:0.9rem; cursor:pointer;">
          <input type="checkbox" id="autoClean" checked> å…¨è§’æ•°å­—ã‚’åŠè§’ã«è‡ªå‹•å¤‰æ›
        </label>
      </div>
      <button id="convertBtn">âœ¨ ãã‚Œã„ãªExcelã¨ã—ã¦ä¿å­˜</button>
    </div>

    <div id="tableWrapper">
      <table id="dataTable">
        </table>
    </div>
    <div style="margin-top:8px; text-align:right; font-size:0.8rem; color:#666;" id="rowCountInfo"></div>
  </div>

  <div id="loadingOverlay">
    <div class="spinner"></div>
    <div style="margin-top:15px; font-weight:bold; color:#475569;" id="loadingText">å‡¦ç†ä¸­...</div>
  </div>

<script>
/**
 * ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼: é«˜æ©Ÿèƒ½Excelã‚¨ãƒ‡ã‚£ã‚¿ãƒ»ã‚³ãƒ³ãƒãƒ¼ã‚¿
 */

// UIè¦ç´ 
const dropZone = document.getElementById('dropZone');
const fileInput = document.getElementById('fileInput');
const fileStatus = document.getElementById('fileStatus');
const inputArea = document.getElementById('inputArea');
const editorArea = document.getElementById('editorArea');
const tableWrapper = document.getElementById('tableWrapper');
const dataTable = document.getElementById('dataTable');
const loadingOverlay = document.getElementById('loadingOverlay');
const loadingText = document.getElementById('loadingText');

let originalFileName = 'data';

// --- ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®š ---

dropZone.addEventListener('click', () => fileInput.click());
dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.classList.add('dragover'); });
dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));
dropZone.addEventListener('drop', (e) => {
  e.preventDefault();
  dropZone.classList.remove('dragover');
  if (e.dataTransfer.files.length) loadFile(e.dataTransfer.files[0]);
});
fileInput.addEventListener('change', () => { if (fileInput.files.length) loadFile(fileInput.files[0]); });

document.getElementById('convertBtn').addEventListener('click', exportBeautifulExcel);

// --- ãƒ­ã‚¸ãƒƒã‚¯ ---

function showLoading(show, text = 'å‡¦ç†ä¸­...') {
  loadingOverlay.style.display = show ? 'flex' : 'none';
  loadingText.textContent = text;
}

// ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿æŒ¯ã‚Šåˆ†ã‘
async function loadFile(file) {
  originalFileName = file.name.replace(/\.[^/.]+$/, "");
  fileStatus.textContent = file.name;
  fileStatus.className = 'badge info';
  
  showLoading(true, 'ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è§£æä¸­...');

  // UIåˆ‡ã‚Šæ›¿ãˆ
  inputArea.style.display = 'none';
  editorArea.style.display = 'block';

  try {
    const buffer = await file.arrayBuffer();
    const ext = file.name.split('.').pop().toLowerCase();
    let rows = [];

    if (ext === 'xlsx' || ext === 'xls') {
      // Excelèª­ã¿è¾¼ã¿
      const wb = new ExcelJS.Workbook();
      await wb.xlsx.load(buffer);
      const sheet = wb.worksheets[0]; // 1ã‚·ãƒ¼ãƒˆç›®ã®ã¿
      sheet.eachRow({ includeEmpty: false }, (row) => {
        // ã‚»ãƒ«ã®å€¤ã‚’å–å¾—ï¼ˆæ•°å¼ã®å ´åˆã¯çµæœï¼‰
        const rowVal = [];
        row.eachCell({ includeEmpty: true }, (cell, colNumber) => {
          // é…åˆ—ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’åˆã‚ã›ã‚‹ãŸã‚è©°ã‚è¾¼ã¿
          while(rowVal.length < colNumber - 1) rowVal.push('');
          const val = (cell.result !== undefined) ? cell.result : cell.value;
          // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ(ãƒªãƒƒãƒãƒ†ã‚­ã‚¹ãƒˆç­‰)ã®å ´åˆã¯æ–‡å­—åˆ—åŒ–
          rowVal.push((val && typeof val === 'object' && val.text) ? val.text : val);
        });
        rows.push(rowVal);
      });
    } else {
      // CSV/Textèª­ã¿è¾¼ã¿ (è‡ªå‹•åˆ¤å®š)
      const detectedEnc = detectEncoding(buffer);
      const text = decodeText(buffer, detectedEnc);
      const result = Papa.parse(text, { skipEmptyLines: true });
      rows = result.data;
    }

    // è¡Œæ•°ãŒå¤šã™ãã‚‹å ´åˆã®è­¦å‘Š
    if (rows.length > 5000) {
      if(!confirm(`ãƒ‡ãƒ¼ã‚¿ãŒ ${rows.length} è¡Œã‚ã‚Šã¾ã™ã€‚\nå…¨ä»¶è¡¨ç¤ºã™ã‚‹ã¨ãƒ–ãƒ©ã‚¦ã‚¶ãŒé‡ããªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ãŒã€ç¶šè¡Œã—ã¾ã™ã‹ï¼Ÿ`)) {
        location.reload();
        return;
      }
    }

    renderTable(rows);

  } catch (err) {
    console.error(err);
    alert('èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ' + err.message);
    location.reload();
  } finally {
    showLoading(false);
  }
}

// æ–‡å­—ã‚³ãƒ¼ãƒ‰åˆ¤å®š (jschardet)
function detectEncoding(buffer) {
  const bytes = new Uint8Array(buffer.slice(0, 65535));
  let binary = '';
  for (let i = 0; i < bytes.length; i++) binary += String.fromCharCode(bytes[i]);
  const det = jschardet.detect(binary);
  if (!det || !det.encoding) return 'UTF-8';
  if (det.encoding.toUpperCase() === 'SHIFT_JIS') return 'Shift_JIS';
  return det.encoding;
}

// ãƒ‡ã‚³ãƒ¼ãƒ‰
function decodeText(buffer, encoding) {
  const uint8 = new Uint8Array(buffer);
  try {
    const decoder = new TextDecoder(encoding);
    return decoder.decode(uint8);
  } catch(e) {
    // fallback
    return new TextDecoder('utf-8').decode(uint8);
  }
}

// ãƒ†ãƒ¼ãƒ–ãƒ«æç”»ï¼ˆç·¨é›†å¯èƒ½ï¼‰
function renderTable(rows) {
  dataTable.innerHTML = '';
  if (rows.length === 0) return;

  const maxCols = rows.reduce((m, r) => Math.max(m, r.length), 0);
  const thead = document.createElement('thead');
  const tbody = document.createElement('tbody');

  // ãƒ˜ãƒƒãƒ€è¡Œ (1è¡Œç›®ã‚’ãƒ˜ãƒƒãƒ€ã¨ä»®å®šã€ã‚‚ã—ãã¯åˆ—ç•ªå·)
  const headerRow = document.createElement('tr');
  // è¡Œç•ªå·ã‚«ãƒ©ãƒ 
  const thNum = document.createElement('th');
  thNum.textContent = '#';
  thNum.style.width = '40px';
  headerRow.appendChild(thNum);

  // ãƒ‡ãƒ¼ã‚¿ã‚«ãƒ©ãƒ ãƒ˜ãƒƒãƒ€
  for (let c = 0; c < maxCols; c++) {
    const th = document.createElement('th');
    // 1è¡Œç›®ã‚’ãƒ˜ãƒƒãƒ€ã¨ã—ã¦æ‰±ã†ã‹ã€A, B, C...ã«ã™ã‚‹ã‹
    // ã“ã“ã§ã¯ã€Œ1è¡Œç›®ã‚’ãƒ˜ãƒƒãƒ€ã¨ã—ã¦æ‰±ã†ã€ã‚¹ã‚¿ã‚¤ãƒ«ã«ã—ã¾ã™
    const val = (rows[0] && rows[0][c]) ? rows[0][c] : `åˆ— ${c+1}`;
    th.textContent = String(val);
    headerRow.appendChild(th);
  }
  thead.appendChild(headerRow);

  // ãƒ‡ãƒ¼ã‚¿è¡Œ (2è¡Œç›®ä»¥é™)
  for (let r = 1; r < rows.length; r++) {
    const tr = document.createElement('tr');
    
    // è¡Œç•ªå·
    const tdNum = document.createElement('td');
    tdNum.className = 'row-num';
    tdNum.textContent = r;
    tr.appendChild(tdNum);

    for (let c = 0; c < maxCols; c++) {
      const td = document.createElement('td');
      td.contentEditable = "true"; // â˜…ã“ã“ã§ç·¨é›†å¯èƒ½ã«ã™ã‚‹
      const val = rows[r][c];
      td.textContent = (val === null || val === undefined) ? '' : val;
      tr.appendChild(td);
    }
    tbody.appendChild(tr);
  }

  dataTable.appendChild(thead);
  dataTable.appendChild(tbody);
  
  document.getElementById('rowCountInfo').textContent = `è¡¨ç¤ºä¸­: ${rows.length - 1} ä»¶ã®ãƒ‡ãƒ¼ã‚¿ (ï¼‹ãƒ˜ãƒƒãƒ€)`;
}

// â˜…ãƒ¡ã‚¤ãƒ³ï¼šãã‚Œã„ãªExcelã¨ã—ã¦ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
async function exportBeautifulExcel() {
  showLoading(true, 'Excelã‚’ç”Ÿæˆä¸­...');
  
  // å°‘ã—å¾…ã£ã¦UIæç”»ã•ã›ã‚‹
  await new Promise(r => setTimeout(r, 50));

  try {
    const wb = new ExcelJS.Workbook();
    const sheet = wb.addWorksheet('Sheet1');
    const doClean = document.getElementById('autoClean').checked;

    // ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å¸ã„ä¸Šã’ã‚‹
    // â€» thead (0è¡Œç›®) ã¨ tbody (ãƒ‡ãƒ¼ã‚¿) ã‚’å–å¾—
    
    // 1. ãƒ˜ãƒƒãƒ€å–å¾—
    const ths = dataTable.querySelectorAll('thead th');
    const headerValues = [];
    // æœ€åˆã®thã¯è¡Œç•ªå·ç”¨ãªã®ã§ã‚¹ã‚­ãƒƒãƒ—
    for (let i = 1; i < ths.length; i++) {
      headerValues.push(ths[i].textContent);
    }
    
    // Excelã«è¿½åŠ 
    const headerRow = sheet.addRow(headerValues);

    // â˜…ãƒ˜ãƒƒãƒ€ã®ãƒ‡ã‚¶ã‚¤ãƒ³è¨­å®šï¼ˆç¾ã—ã„ç½«ç·šã¨è‰²ï¼‰
    headerRow.eachCell((cell) => {
      cell.fill = {
        type: 'pattern',
        pattern: 'solid',
        fgColor: { argb: 'FF4472C4' } // Excelã®é’
      };
      cell.font = {
        color: { argb: 'FFFFFFFF' }, // ç™½æ–‡å­—
        bold: true,
        name: 'Meiryo UI'
      };
      cell.alignment = { vertical: 'middle', horizontal: 'center' };
      cell.border = {
        top: { style: 'thin' },
        left: { style: 'thin' },
        bottom: { style: 'medium' }, // ãƒ˜ãƒƒãƒ€ä¸‹ã¯å°‘ã—å¤ªã
        right: { style: 'thin' }
      };
    });
    headerRow.height = 24; // å°‘ã—é«˜ã•ã‚’å‡ºã™

    // 2. ãƒ‡ãƒ¼ã‚¿å–å¾—
    const trs = dataTable.querySelectorAll('tbody tr');
    // åˆ—å¹…è¨ˆç®—ç”¨
    const colWidths = new Array(headerValues.length).fill(12);

    for (let r = 0; r < trs.length; r++) {
      const tds = trs[r].querySelectorAll('td');
      const rowData = [];
      // æœ€åˆã®tdã¯è¡Œç•ªå·ãªã®ã§ã‚¹ã‚­ãƒƒãƒ—
      for (let c = 1; c < tds.length; c++) {
        let val = tds[c].textContent; // ç·¨é›†å¾Œã®å€¤ã‚’å–å¾—

        if (doClean) val = cleanValue(val);
        
        // æ•°å€¤å¤‰æ›
        const num = Number(val.replace(/,/g, ''));
        if (!isNaN(num) && val.trim() !== '') {
          rowData.push(num);
        } else {
          rowData.push(val);
        }
        
        // åˆ—å¹…æ›´æ–° (æ–‡å­—æ•°ãƒ™ãƒ¼ã‚¹ã®ç°¡æ˜“è¨ˆç®—)
        const len = (val.length * 1.5) + 2;
        if (len > colWidths[c-1]) colWidths[c-1] = Math.min(len, 60);
      }
      
      const newRow = sheet.addRow(rowData);
      
      // â˜…ãƒ‡ãƒ¼ã‚¿è¡Œã®ãƒ‡ã‚¶ã‚¤ãƒ³è¨­å®š
      const isEven = (r % 2 === 0); // 0 start -> 1è¡Œç›®ãƒ‡ãƒ¼ã‚¿(å¥‡æ•°è¡Œæ‰±ã„)
      
      newRow.eachCell({ includeEmpty: true }, (cell, colNum) => {
        // ãƒ•ã‚©ãƒ³ãƒˆ
        cell.font = { name: 'Meiryo UI', size: 10 };
        
        // ç½«ç·šï¼ˆã™ã¹ã¦ç´°ç·šï¼‰
        cell.border = {
          top: { style: 'thin', color: { argb: 'FFBFBFBF' } },
          left: { style: 'thin', color: { argb: 'FFBFBFBF' } },
          bottom: { style: 'thin', color: { argb: 'FFBFBFBF' } },
          right: { style: 'thin', color: { argb: 'FFBFBFBF' } }
        };

        // ã‚¹ãƒˆãƒ©ã‚¤ãƒ—ï¼ˆç¸æ¨¡æ§˜ï¼‰- è¦–èªæ€§å‘ä¸Š
        if (!isEven) { // äº’ã„é•ã„
          cell.fill = {
            type: 'pattern',
            pattern: 'solid',
            fgColor: { argb: 'FFF2F2F2' } // è–„ã„ã‚°ãƒ¬ãƒ¼
          };
        }

        // é…ç½®ã¨è¡¨ç¤ºå½¢å¼
        if (typeof cell.value === 'number') {
           cell.alignment = { horizontal: 'right', vertical: 'middle' };
           cell.numFmt = '#,##0'; // æ¡åŒºåˆ‡ã‚Š
        } else {
           cell.alignment = { horizontal: 'left', vertical: 'middle', wrapText: true };
        }
      });
    }

    // åˆ—å¹…é©ç”¨
    sheet.columns.forEach((col, i) => {
      col.width = colWidths[i] || 12;
    });

    // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦æ ã®å›ºå®šï¼ˆãƒ˜ãƒƒãƒ€å›ºå®šï¼‰
    sheet.views = [{ state: 'frozen', ySplit: 1 }];
    
    // ã‚ªãƒ¼ãƒˆãƒ•ã‚£ãƒ«ã‚¿ãƒ¼è¨­å®š
    sheet.autoFilter = {
      from: { row: 1, column: 1 },
      to: { row: 1, column: headerValues.length }
    };

    // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å‡¦ç†
    const buf = await wb.xlsx.writeBuffer();
    const blob = new Blob([buf], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `${originalFileName}_ãã‚Œã„ãªãƒ‡ãƒ¼ã‚¿.xlsx`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);

  } catch(e) {
    console.error(e);
    alert('ä¿å­˜ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚\n' + e.message);
  } finally {
    showLoading(false);
  }
}

// ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ï¼ˆå…¨è§’æ•°å­—â†’åŠè§’ãªã©ï¼‰
function cleanValue(str) {
  if (!str) return str;
  // å…¨è§’è‹±æ•°å¤‰æ›
  return str.replace(/[ï¼¡-ï¼ºï½-ï½šï¼-ï¼™]/g, function(s) {
    return String.fromCharCode(s.charCodeAt(0) - 0xFEE0);
  }).trim();
}

</script>
</body>
</html>
